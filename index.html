<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg/dist/ffmpeg.min.js"></script>
    <script src="main.js"></script>
    <title>Advanced Video Player</title>
</head>
<body>
    <div class="wmp-video-player">
        <input type="file" id="fileInput" multiple>
        <div id="cardContainer"></div>
        <video id="video" src=" " controls></video>
        <div class="controls">
            <button class="play-pause-btn" id="playPauseBtn">Play</button>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress" id="progress"></div>
                </div>
                <span class="time" id="currentTime">0:00</span> / <span class="time" id="duration">0:00</span>
            </div>
            <button class="mute-btn" id="muteBtn">Mute</button>
            <div class="volume-container">
                <div class="volume-bar" id="volumeBar">
                    <div class="volume-level" id="volumeLevel"></div>
                </div>
            </div>
            <button class="fullscreen-btn" id="fullscreenBtn">Fullscreen</button>
            <input type="text" id="fileName" placeholder="Output File Name">
            <button class="download-btn" id="downloadBtn">Download</button>
            <select class="resolution-select" id="resolutionSelect">
                <option value="240">240p</option>
                <option value="360">360p</option>
                <option value="480">480p</option>
                <option value="720">720p</option>
                <option value="1080">1080p</option>
                <option value="2160">4K</option>
                <option value="4320">8K</option>
            </select>
            <button class="split-video-btn" id="splitVideoBtn">Split Video</button>
            <button class="split-audio-btn" id="splitAudioBtn">Split Audio</button>
        </div>
    </div>
    
    <div class="edit-panel">
        <label>
            Noise Reduction: <input type="range" id="noiseReduction" min="0" max="100" value="0">
        </label>
        <label>
            Echo: <input type="range" id="echo" min="0" max="100" value="0">
        </label>
        <label>
            Bass: <input type="range" id="bass" min="0" max="100" value="50">
        </label>
        <label>
            Treble: <input type="range" id="treble" min="0" max="100" value="50">
        </label>
        <label>
            Playback Speed: <input type="range" id="playbackSpeed" min="0.5" max="2" step="0.1" value="1">
        </label>
    </div>

    <div class="card-container" id="cardContainer"></div>
    

    <script type="text/javascript">


        document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.getElementById('fileInput');
    const cardContainer = document.getElementById('cardContainer');
    const downloadBtn = document.getElementById('downloadBtn');
    const fileNameInput = document.getElementById('fileName');
    const resolutionSelect = document.getElementById('resolutionSelect');
    const splitVideoBtn = document.getElementById('splitVideoBtn');
    const splitAudioBtn = document.getElementById('splitAudioBtn');
    const videoElement = document.getElementById('video');
    const tracks = [];

    const videoElement = fileInput;


            
    downloadBtn.addEventListener('click', async () => {
        try {
            const resolution = resolutionSelect.value;
            const { createFFmpeg, fetchFile } = FFmpeg;
            const ffmpeg = createFFmpeg({ log: true });
            await ffmpeg.load();

            for (const track of tracks) {
                await ffmpeg.FS('writeFile', track.file.name, await fetchFile(track.file));
            }

            const inputs = tracks.map(track => `-i ${track.file.name}`).join(' ');
            const filters = tracks.map((track, index) => {
                if (track.type === 'image') {
                    return `[${index}:v]scale=-1:${resolution},setsar=1:1[v${index}]`;
                } else if (track.type === 'video') {
                    return `[${index}:v]scale=-1:${resolution},setsar=1:1[v${index}]`;
                } else {
                    return `[${index}:a]`;
                }
            }).join('; ');

            const command = `-filter_complex "${filters}" -map "[v0]" -map "${tracks.length > 1 ? '[a]' : '[a0]'}" output.mp4`;

            await ffmpeg.run(...inputs.split(' '), command);
            const data = await ffmpeg.FS('readFile', 'output.mp4');
            const blob = new Blob([data.buffer], { type: 'video/mp4' });
            const videoUrl = URL.createObjectURL(blob);

            // Aggiornamento del tag video con il nuovo video
            videoElement.src = videoUrl;
            videoElement.controls = true;
        } catch (error) {
            console.error(error);
            alert("An error occurred while generating the video.");
        }
    });

});

document.getElementById('video').innerHTML = videoElement;

    </script>
        


</body>
</html>
